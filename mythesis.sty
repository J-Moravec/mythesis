%% mythesis style for LaTeX2e.
%
% Style for postgraduate theses at Massey University.
% author: Jiří Moravec
% date: July, 2015
%
% Based on muthesis style by Stephen Marsland
% but it is more fancy.

\NeedsTeXFormat{LaTeX2e}
\RequirePackage{fancyhdr}
\RequirePackage{setspace}
\RequirePackage{hyperref}
\RequirePackage[width=.90\textwidth,font={small,sf}]{caption}
\newif\ifonehalfsp@
\newif\ifdoublesp@
\newif\ifblackl@
\doublesp@false
\onehalfsp@false

\DeclareOption{onehalfspace}{\onehalfsp@true}
\DeclareOption{doublespace}{\doublesp@true}
%\DeclareOption{PhD}{\def\degreetitle{Doctor of Philosophy}}
%\DeclareOption{MSc}{\def\degreetitle{Master of Science}}
%\DeclareOption{ME}{\def\degreetitle{Master of Engineering}}
%\DeclareOption{MPhil}{\def\degreetitle{Master of Philosophy}}
%\DeclareOption{MTech}{\def\degreetitle{Master of Technology}}
%\DeclareOption{PGDip}{\def\degreetitle{Postgraduate Diploma in Science}}
\DeclareOption{blacklinks}{\blackl@true}
\ProcessOptions

%% \author, \title are defined in report; here are the rest of the
%% front matter defining macros
%% Note: If you really want, you can define your own macro for, say
%% \supervisor , just by copying the definitions of \principaladvisor
%%
%\def\dept#1{\gdef\@dept{#1}}
%\def\school#1{\gdef\@dept{#1}}
%\def\faculty#1{\gdef\@faculty{#1}}

%\def\@title{}\def\@author{}
%\newcommand{\campus}[1]{\ifx\empty#1\else\gdef\@campus{#1}\fi}
%\newcommand{\subject}[1]{\ifx\empty#1\else\gdef\@subject{#1}\fi}
%\def\@submitdate{\number\the\year}

%% Disallow page breaks at hyphens (this will give some underfull vbox's,
%% so an alternative is to use \brokenpenalty=100 and manually search
%% for and fix such page breaks)
\brokenpenalty=10000

\hypersetup{hidelinks=true}


%% Set up line spacing, the default is singlespacing
\AtBeginDocument{%
    \ifdoublesp@%
        \doublespacing%
    \else
        \ifonehalfsp@%
            \onehalfspacing%
        \else%
            \singlespacing%
        \fi%
    \fi
%\ifblackl@
%    \hypersetup{
%        %colorlinks,%=false
%        hidelinks=true
%        }
%    \else\typeout{********************blackfalse*****************}
%\fi%
    } % Simple example of ifelse I used for some debugging.


% Better date
\newcommand{\monthtext}{%
  \ifcase\the\month
  \or January% 1
  \or February% 2
  \or March% 3
  \or April% 4
  \or May% 5
  \or June% 6
  \or July% 7
  \or August% 8
  \or September% 9
  \or October% 10
  \or November% 11
  \or December% 12
  \fi}


%% Sensible margins, default margins are too big.
\usepackage[top=22mm, bottom=24mm, left=34mm, right=25mm, headsep=6mm,
            footskip=8mm, includeheadfoot, headheight=14pt]{geometry}


%% Before abstract definition.
% contains titlepage, table of content and list of tables and figures.
\def\beforeabstract{
    \pagenumbering{roman}
    \pagestyle{plain}
    \maketitle
    \cleardoublepage
    \tableofcontents % adds table of contents
    \addcontentsline{toc}{chapter}{Contents} % adds Contents into table of contents
    \cleardoublepage
    \addvspace{10pt}
    \listoftables
    \addcontentsline{toc}{chapter}{List of tables}
    \cleardoublepage
    \addvspace{10pt}
    \listoffigures
    \addcontentsline{toc}{chapter}{List of figures}
    \newpage
    }


%% Definition of simple chapters used in preface section.
\def\prefacesection#1{%
        \chapter*{#1}
        \addcontentsline{toc}{chapter}{#1}}


%% Titlepage according to muthesis of Stephen Marsland.
%\renewcommand\maketitle{%
%    \thispagestyle{empty}%
%    \null\vskip1in%
%    \begin{center}
%        \Huge\uppercase\expandafter{\@title}
%        \end{center}
%    \vfill
%    \begin{center}
%        \textsc{A thesis presented in partial fulfilment of 
%                the requirements for the degree of\\
%        {\degreetitle} \\
%        in \\
%        {\@subject}\\
%        at Massey University, {\@campus},\\
%        New Zealand.}
%       \end{center}
%    \vfill
%    \begin{center}
%        \normalfont \@author
%        \end{center}
%    \vfill
%    \begin{center}
%        \@submitdate
%        \end{center}
%    \vskip.5in
%    \newpage
%    }


%% After preface definition of style
% Change numbering to arabic, and style to fancy 
% (with head and foot definition). It also redefine plain style,
% as first chapter page is always plain.
\def\afterpreface{
    \newpage
    \pagenumbering{arabic}
    \pagestyle{fancy}
    \fancypagestyle{plain}{%
        \fancyhf{}
        \if@twoside
            \fancyfoot[RO]{\it\small \thepage}% TWOSIDE
            \fancyfoot[LE]{\it\small \thepage}% TWOSIDE
        \else
            \fancyfoot[R]{\it\small \thepage}% ONESIDE
        \fi
        \renewcommand{\headrulewidth}{0pt}
        \renewcommand{\footrulewidth}{0pt}
        }
    \fancyhf{}%
    \if@twoside
        \fancyhead[CO]{\small\it \leftmark\ \hfill  \thepage}% TWOSIDE
        \fancyhead[CE]{\small\it \thepage\  \hfill \leftmark}% TWOSIDE
    \else
        \fancyhead[C]{\small\it  \leftmark\ \hfill \thepage}% ONESIDE
    \fi
    }

%% chapterx, sectionx, subsectionx
% redefined chapter, section and subsection
% Simple and clean, without burdening formating of traditional latex chapter.
% If you like simpler style, but you would still like numbering, use
% chapternnum, sectionnum and subsectionnum, which are currently as default
% as chapter, section and subsection.
% Also, you can use this as starting point to define your own style.
%\newcommand{\chapterx}[1]{
%    \stepcounter{chapter}\chapter*{#1}
%    \addcontentsline{toc}{chapter}{#1}\markboth{#1}{#1}
%    }
%\newcommand{\sectionx}[1]{
%    \stepcounter{section}\section*{#1}
%    \addcontentsline{toc}{section}{#1}\markright{#1}
%    }
%\newcommand{\subsectionx}[1]{
%    \stepcounter{subsection}\subsection*{#1}
%    \addcontentsline{toc}{subsection}{#1}
%    }


%% chapternum, sectionnum, subsectionnum
% redefined chapter, section and subsection
% similar style as chapterx, but with additional numbering
% you can think about this as traditional, but simpler, style.
% If you do not want to use this, comment this out 
%
% Just note, redefining chapter and so from scratch is quite complicated, see
% definition in book module. Here we just use present chapter as base.

% save chapter into chaptertemp
\let\chaptertemp\chapter
% redefine chapter with original stared chapter and chapternum. Chapternum is
% defined using stared chapter, now chaptertemp.
\makeatletter
\renewcommand*\chapter{
    \@ifstar{\chaptertemp*}{\chapternum}}
\makeatother


% the same for section and subsection
\let\sectiontemp\section
\makeatletter
\renewcommand*\section{
    \@ifstar{\sectiontemp*}{\sectionnum}}
\makeatother

\let\subsectiontemp\subsection
\makeatletter
\renewcommand*\subsection{
    \@ifstar{\subsectiontemp*}{\subsectionnum}}
\makeatother


\newcommand{\chapternum}[1]{
    \stepcounter{chapter}\chaptertemp*{\thechapter. #1}
    \addcontentsline{toc}{chapter}{\thechapter. #1}
    \markboth{\thechapter. #1}{\thechapter. #1}
    }
\newcommand{\sectionnum}[1]{
    \stepcounter{section}\sectiontemp*{\thesection. #1}
    \addcontentsline{toc}{section}{\thesection. #1}
    \markright{\thesection. #1}
    }
\newcommand{\subsectionnum}[1]{
    \stepcounter{subsection}
    \subsectiontemp*{\thesubsection. #1}
    \addcontentsline{toc}{subsection}{\thesubsection. #1}
    }
% Of course, we could just use *num varieties and not do this substitution.
% But we can, so why not?:)

